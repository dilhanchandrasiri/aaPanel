const __vite__fileDeps=["js/index134.js?v=1723125373998","js/index.js?v=1723125373998","js/vue.js?v=1723125373998","js/pinia.js?v=1723125373998","css/index42.css?v=1723125373998","js/index73.js?v=1723125373998","js/useTableData.js?v=1723125373998","js/data.js?v=1723125373998","js/Skeleton.js?v=1723125373998","js/DataTable.js?v=1723125373998","js/Checkbox.js?v=1723125373998","js/Ellipsis.js?v=1723125373998","js/Select.js?v=1723125373998","js/Tag.js?v=1723125373998","js/Empty.js?v=1723125373998","js/omit.js?v=1723125373998","js/useLoading.js?v=1723125373998","js/mail.js?v=1723125373998","js/index.vue_vue_type_script_setup_true_lang6.js?v=1723125373998","js/index145.js?v=1723125373998","js/Spin.js?v=1723125373998","css/index21.css?v=1723125373998","js/useLoop.js?v=1723125373998"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{n as e,cH as a,j as t,h as s,cI as n,am as l,a as i,cJ as o,cG as r,B as u,ae as c,k as d,g as p,e as m,_ as v,bt as f,G as _,q as h,au as y,L as g,cK as w,r as x,v as b}from"./index.js?v=1723125373998";import{_ as k}from"./index70.js?v=1723125373998";import{s as C}from"./pinia.js?v=1723125373998";import{H as P,I as S,J as j,K as R,L as U,h as I,M as L,N as M,O as A,P as B,Q as T,R as D,S as E,T as W,U as $}from"./mail.js?v=1723125373998";import{l as z,S as N,Z as V,_ as G,a3 as H,D as O,r as q,U as F,V as J,P as K,q as Q,W as Z,b as X,f as Y,k as ee,aj as ae,af as te,F as se,ad as ne,a1 as le,a5 as ie,a6 as oe}from"./vue.js?v=1723125373998";import{a as re,b as ue}from"./DataTable.js?v=1723125373998";import{_ as ce}from"./InputGroupLabel.js?v=1723125373998";import{_ as de}from"./InputGroup.js?v=1723125373998";import{_ as pe,a as me}from"./index.vue_vue_type_script_setup_true_lang6.js?v=1723125373998";import{u as ve}from"./useLoading.js?v=1723125373998";import{g as fe}from"./site.js?v=1723125373998";import{_ as _e}from"./Select.js?v=1723125373998";import{_ as he}from"./Checkbox.js?v=1723125373998";import{_ as ye}from"./Switch.js?v=1723125373998";import{u as ge,_ as we}from"./useTableData.js?v=1723125373998";import{g as xe,b as be}from"./useTableColumns.js?v=1723125373998";import{_ as ke}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1723125373998";import"./Ellipsis.js?v=1723125373998";import"./Empty.js?v=1723125373998";import"./omit.js?v=1723125373998";import"./Tag.js?v=1723125373998";import"./data.js?v=1723125373998";import"./Skeleton.js?v=1723125373998";import"./Progress.js?v=1723125373998";import"./file2.js?v=1723125373998";import"./Spin.js?v=1723125373998";const Ce={class:"setting-card"},Pe={class:"setting-title"},Se=i(z({__name:"index",props:{title:{default:""}},setup:e=>(e,a)=>(N(),V("div",Ce,[G("div",Pe,H(e.title),1),O(e.$slots,"default",{},void 0,!0)]))}),[["__scopeId","data-v-61fff8e2"]]),je={class:"flex items-center"},Re=z({__name:"index",setup(a){const s=o(),n=q(0),l=q(null),i=async()=>{l.value||0===l.value?(await P({save_day:0===n.value?0:l.value}),c()):e.error("Please enter the save time")},c=async()=>{const{message:e}=await S();t(e)&&(0===e.result?(n.value=0,l.value=null):(n.value=1,l.value=e.result))};return s.setup&&c(),(e,a)=>{const t=re,s=ue,o=r,c=ce,d=de,p=u;return N(),F(Se,{title:"Mail save time"},{default:J((()=>[G("div",je,[K(s,{value:Z(n),"onUpdate:value":a[0]||(a[0]=e=>X(n)?n.value=e:null)},{default:J((()=>[K(t,{value:0},{default:J((()=>[Q("Always keep")])),_:1}),K(t,{class:"ml-24px",value:1},{default:J((()=>[Q("Customize")])),_:1})])),_:1},8,["value"]),K(d,{class:"w-240px"},{default:J((()=>[K(o,{value:Z(l),"onUpdate:value":a[1]||(a[1]=e=>X(l)?l.value=e:null),class:"flex-1 ml-16px",min:0,disabled:0===Z(n),"show-button":!1,placeholder:"Please enter the save time"},null,8,["value","disabled"]),K(c,null,{default:J((()=>[Q("Days")])),_:1})])),_:1}),K(p,{class:"ml-24px",type:"primary",ghost:"",onClick:i},{default:J((()=>[Q(H(e.$t("Public.Btn.Save")),1)])),_:1})])])),_:1})}}}),Ue={class:"p-20px pt-24px pb-8px"},Ie={class:"w-280px"},Le={class:"w-280px"},Me=z({__name:"install",emits:["refresh"],setup(e,{expose:a,emit:s}){const n=s,l=q(null),i=Y({domain:"",php_version:null}),o={domain:{trigger:"change",validator:()=>""!==i.domain.trim()||new Error("Please input domain")},php_version:{trigger:"change",validator:()=>null!==i.php_version||new Error("Please select PHP version")}},r=q([]),u=async()=>{const{message:e}=await fe();t(e)&&(r.value=e.versions.reverse().map((e=>({label:e.name,value:e.version}))),i.php_version=e.versions[0].version)},{loading:d,setLoading:p}=ve();return(async()=>{try{p(!0),await Promise.all([u()])}finally{p(!1)}})(),a({onConfirm:async()=>{var e;await(null==(e=l.value)?void 0:e.validate()),await j({site_name:i.domain||"",php_version:i.php_version||""}),n("refresh")}}),(e,a)=>{const t=c,s=pe,n=_e,u=me;return N(),V("div",Ue,[K(u,{ref_key:"formRef",ref:l,model:Z(i),rules:o},{default:J((()=>[K(s,{label:"Domain",path:"domain"},{default:J((()=>[G("div",Ie,[K(t,{value:Z(i).domain,"onUpdate:value":a[0]||(a[0]=e=>Z(i).domain=e)},null,8,["value"])])])),_:1}),K(s,{label:"PHP Version",path:"php_version"},{default:J((()=>[G("div",Le,[K(n,{value:Z(i).php_version,"onUpdate:value":a[1]||(a[1]=e=>Z(i).php_version=e),loading:Z(d),options:Z(r)},null,8,["value","loading","options"])])])),_:1})])),_:1},8,["model"])])}}}),Ae={class:"p-20px pt-24px pb-8px"},Be={class:"w-280px"},Te=z({__name:"config",emits:["refresh"],setup(e,{expose:a,emit:s}){const n=s,l=q(null),i=Y({id:0,domain:null,path:""}),o={domain:{trigger:"change",validator:()=>null!==i.domain||new Error("Please select site")}},r=q([]),u=async()=>{const{message:e}=await U();d(e)&&(r.value=e.map((e=>({label:e.name,value:e.name,data:e}))),e.length&&(i.domain=e[0].name,i.path=e[0].path,i.id=e[0].id))},c=(e,a)=>{const{data:s}=a;t(s)&&(i.id=s.id,i.path=s.path)},{loading:p,setLoading:m}=ve();return(async()=>{try{m(!0),await Promise.all([u()])}finally{m(!1)}})(),a({onConfirm:async()=>{var e;await(null==(e=l.value)?void 0:e.validate()),await R({id:i.id,site_name:i.domain||"",path:i.path}),n("refresh")}}),(e,a)=>{const t=_e,s=pe,n=me;return N(),V("div",Ae,[K(n,{ref_key:"formRef",ref:l,model:Z(i),rules:o},{default:J((()=>[K(s,{label:"Site",path:"domain"},{default:J((()=>[G("div",Be,[K(t,{value:Z(i).domain,"onUpdate:value":[a[0]||(a[0]=e=>Z(i).domain=e),c],loading:Z(p),options:Z(r)},null,8,["value","loading","options"])])])),_:1})])),_:1},8,["model"])])}}}),De={class:"flex items-center mr-32px text-13px"},Ee=G("span",{class:"mr-10px"},"Install status:",-1),We={key:0,class:"mr-32px text-13px"},$e=G("span",{class:"mr-10px"},"URL:",-1),ze=G("span",null,"Add deployed WebMail",-1),Ne=z({__name:"index",setup(e){const a=Y({id:0,site_name:"",status:!1,ssl_status:!1}),n=ee((()=>"".concat(a.ssl_status?"https":"http","://").concat(a.site_name))),l=async()=>{const{message:e}=await I();t(e)&&(a.id=e.id,a.status=e.status,a.site_name=e.site_name,a.ssl_status=e.ssl_status)},i=p("Install Web Mail",{onRefresh:l}),o=()=>{i.show=!0},r=()=>{const e=q(!1);s({title:"Uninstall Web Mail",width:420,content:()=>K(se,null,[K("div",{class:"mb-16px"},[Q("After uninstall WebMail, ["),a.site_name,Q("] is deleted from the website list and cannot be accessed, Continue?")]),K(he,{checked:e.value,onUpdateChecked:a=>{e.value=a}},{default:()=>[K("div",{class:"text-desc leading-[1.4]"},[Q("FTP, Database, Document Root will be completely deleted after selection, Please be careful!")])]})]),onConfirm:async()=>{await L({id:a.id,site_name:a.site_name,force:e.value?1:0}),l()}})},c=p("Add deployed WebMail",{onRefresh:l}),d=()=>{c.show=!0};return l(),(e,t)=>{const s=m,l=u,p=v,y=f,g=_,w=h;return N(),F(Se,{title:"WebMail"},{default:J((()=>[K(g,{class:"items-center",size:0},{default:J((()=>[G("div",De,[Ee,G("span",{class:ae(Z(a).status?"text-primary":"text-error")},H(Z(a).status?"Install":"Not install"),3)]),Z(a).status?(N(),V("div",We,[$e,K(s,{href:Z(n),target:"_blank"},{default:J((()=>[Q(H(Z(n)),1)])),_:1},8,["href"])])):te("",!0),Z(a).status?(N(),F(l,{key:1,onClick:r},{default:J((()=>[Q(H(e.$t("Public.Btn.Uninstall")),1)])),_:1})):(N(),V(se,{key:2},[K(l,{type:"primary",ghost:"",onClick:o},{default:J((()=>[Q(H(e.$t("Public.Btn.Install")),1)])),_:1}),K(l,{class:"ml-10px",onClick:d},{default:J((()=>[ze])),_:1}),K(y,null,{trigger:J((()=>[K(p,{class:"ml-6px",name:"common-ask",size:"16"})])),default:J((()=>[Q(" If you have used Roundcube WebMail installed with one-click deployment, you can add it here ")])),_:1})],64))])),_:1}),K(w,{show:Z(i).show,"onUpdate:show":t[0]||(t[0]=e=>Z(i).show=e),title:Z(i).title,data:Z(i).data,width:480,footer:!0,"confirm-text":e.$t("Public.Btn.Install"),component:Me},null,8,["show","title","data","confirm-text"]),K(w,{show:Z(c).show,"onUpdate:show":t[1]||(t[1]=e=>Z(c).show=e),title:Z(c).title,data:Z(c).data,width:480,footer:!0,component:Te},null,8,["show","title","data"])])),_:1})}}}),Ve=G("div",{class:"text-13px"},"Automatically start services",-1),Ge=z({__name:"index",setup(e){const a=o(),t=q(!1),n=async e=>{e?s({title:"Enable Service Status Monitoring",width:380,content:"Checks the status of the post office service and restarts it automatically if it is stopped",onConfirm:async()=>{await M()},onPublicClose:()=>{t.value=!e}}):await A()},{loading:l,setLoading:i}=ve();return a.setup&&(async()=>{try{i(!0),await B(),t.value=!0}catch(e){t.value=!1}finally{i(!1)}})(),(e,a)=>{const s=ye,i=_;return N(),F(Se,{title:"Monitoring"},{default:J((()=>[K(i,{class:"items-center",size:24},{default:J((()=>[Ve,K(s,{value:Z(t),"onUpdate:value":[a[0]||(a[0]=e=>X(t)?t.value=e:null),n],loading:Z(l)},null,8,["value","loading"])])),_:1})])),_:1})}}}),He={class:"p-16px"},Oe=z({__name:"config",props:{row:{}},setup(e,{expose:a}){const s=e,{row:n}=s,l=q(""),i=q("utf-8"),{loading:o,setLoading:r}=ve();return(async()=>{try{r(!0);const{message:e}=await T({service:n.key});t(e)&&(l.value=e.data,i.value=e.encoding)}finally{r(!1)}})(),a({onConfirm:async()=>{await D({service:n.key,data:l.value})}}),(e,a)=>(N(),V("div",He,[K(ke,{value:Z(l),"onUpdate:value":a[0]||(a[0]=e=>X(l)?l.value=e:null),encoding:Z(i),"onUpdate:encoding":a[1]||(a[1]=e=>X(i)?i.value=e:null),height:550,load:Z(o),"show-encoding":!0},null,8,["value","encoding","load"])]))}}),qe=z({__name:"index",setup(e){const a=o(),{t:n}=ne(),{table:l,columns:i}=ge([{key:"name",title:"Service Name"},{key:"status",title:"Service Status",render:e=>K(xe,{value:e.status,checkedValue:!0,onClick:()=>{r(e)}},null)},be({width:200,options:e=>[{label:e.status?n("Public.Status.Stop"):n("Public.Status.Start"),onClick:()=>{r(e)}},{label:n("Public.Status.Restart"),onClick:()=>{u(e)}},{label:n("Public.Btn.Repair"),onClick:()=>{c(e)}},{label:n("Public.Btn.Config"),onClick:()=>{m(e)}}]})]),r=e=>{s({title:e.status?"Stopping ".concat(e.key," Service"):"Start ".concat(e.key," Service"),content:e.status?"Are you sure to Stop ".concat(e.key," service?"):"Are you sure to start ".concat(e.key," service?"),onConfirm:async()=>{await E({service:e.key,type:e.status?"stop":"start"}),_()}})},u=e=>{s({title:"Restart ".concat(e.key," service"),content:"Are you sure to restart ".concat(e.key," service?"),onConfirm:async()=>{await E({service:e.key,type:"restart"}),_()}})},c=e=>{let a="Are you sure to repair ".concat(e.key," service?");"dovecot"===e.key?a="Config will be restored to default, and invalidate these configuration: SSL. Confirm to continue?":"postfix"===e.key&&(a="Config will be restored to default, and invalidate these configuration: SSL, Anti spam, BCC, SMTP Relay, mail forward. Confirm to continue?"),s({title:"Repair ".concat(e.key," service"),content:a,onConfirm:async()=>{await W({service:e.key,type:"repair"}),_()}})},d=p(),m=e=>{d.data.row=e,d.title="Online Edit [".concat(e.key,"_config_file]"),d.show=!0},{loading:v,setLoading:f}=ve(),_=async()=>{try{f(!0);const{message:e}=await $();t(e)&&(l.data=[],l.data.push({key:"dovecot",name:"Dovecot",status:e.dovecot}),e.change_rspamd?l.data.push({key:"opendkim",name:"Opendkim",status:e.opendkim}):l.data.push({key:"rspamd",name:"Rspamd",status:e.rspamd}),l.data.push({key:"postfix",name:"Postfix",status:e.postfix}))}finally{f(!1)}};return a.setup&&_(),(e,a)=>{const t=we,s=h;return N(),F(Se,{title:"Service Status"},{default:J((()=>[K(t,{loading:Z(v),"loading-num":3,data:Z(l).data,columns:Z(i)},null,8,["loading","data","columns"]),K(s,{show:Z(d).show,"onUpdate:show":a[0]||(a[0]=e=>Z(d).show=e),title:Z(d).title,data:Z(d).data,width:800,height:624,footer:!0,"confirm-text":e.$t("Public.Btn.Save"),component:Oe},null,8,["show","title","data","confirm-text"])])),_:1})}}}),Fe=(e=>(ie("data-v-36ee251b"),e=e(),oe(),e))((()=>G("span",{class:"mr-8px"}," This function can only be used after logging in to the aaPanel account ",-1))),Je={class:"mr-8px"},Ke=i(z({__name:"index",setup(i){const r=o(),{setup:c,install:d,update:p,version:m,lastVersion:v}=C(r),f=y(),{userInfo:_}=C(f),h=()=>{d.value&&!p.value?g({title:"Restoring the mail server environment",width:560,height:550,component:le((()=>b((()=>import("./index134.js?v=1723125373998")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))))}):(async i=>{const{close:o}=e.loading("Processing, please wait...");try{const{message:e}=await a({sName:i});if(t(e)){const a=e.versions[0].full_version;s({title:"Install plugin",content:"Are you sure to install [".concat(e.title," v").concat(a,"] plugin?"),onConfirm:async()=>{e.status?await n({sName:e.name,version:a,upgrade:a}):await n({sName:e.name,version:a}),l()}})}}finally{o()}})("mail_sys")},P=()=>{w()};return(e,a)=>{const t=u,s=x,n=k;return N(),F(n,{install:Z(c)},{desc:J((()=>[Z(_).status?(N(),V(se,{key:1},[G("span",Je,H(Z(d)?Z(p)?"The mail server is v".concat(Z(m),", please upgrade to the version above v").concat(Z(v)," to use"):"Restoring the mail server environment":"Mail server not installed"),1),K(t,{class:"px-8px h-24px",type:"primary",size:"small",onClick:h},{default:J((()=>[Q(H(e.$t("Public.Btn.Install")),1)])),_:1})],64)):(N(),V(se,{key:0},[Fe,K(t,{class:"px-8px h-24px",type:"primary",size:"small",onClick:P},{default:J((()=>[Q(" Register for free now ")])),_:1})],64))])),default:J((()=>[K(s,{class:"p-16px"},{default:J((()=>[K(Ne),K(Re),K(Ge),K(qe)])),_:1})])),_:1},8,["install"])}}}),[["__scopeId","data-v-36ee251b"]]);export{Ke as default};
