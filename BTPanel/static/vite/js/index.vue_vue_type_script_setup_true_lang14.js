import{ao as s,_ as a,L as e}from"./index.js?v=1723125373998";import{_ as t}from"./Progress.js?v=1723125373998";import{l,r as n,k as c,S as r,Z as i,_ as o,a3 as u,W as p,P as d,ad as m,F as x}from"./vue.js?v=1723125373998";import{N as g}from"./DataTable.js?v=1723125373998";const h={class:"w-400px p-20px"},b={class:"mb-12px text-14px"},v=l({__name:"progress",props:{data:{}},emits:["close"],setup(a,{emit:e}){const l=a,{title:m,data:x,api:g,callback:v}=l.data,f=e,_=n(0),S=n(0),w=c((()=>x.length));return(async()=>{for(let e=0;e<x.length;e++)try{if(g){const a=await g(x[e]);x[e].batchStatus="success",x[e].reqMsg=s(a,"message.result","Success"),S.value+=1,S.value===w.value?_.value=100:_.value=Math.round(S.value/w.value*100)}}catch(a){x[e].batchStatus="error",x[e].reqMsg=s(a,"message.result","")}null==v||v(x),f("close")})(),(s,a)=>{const e=t;return r(),i("div",h,[o("div",b,[o("span",null,u(s.$t("Public.Components.index_10",p(m))),1),o("span",null,u(p(S))+"/"+u(p(w)),1)]),d(e,{type:"line",status:"success",percentage:p(_),height:24,"border-radius":4,"fill-border-radius":0,processing:!0,"show-indicator":!1,"indicator-placement":"inside"},null,8,["percentage"])])}}}),f={class:"p-24px"},_={class:"flex items-center mb-24px"},S={class:"flex-1 ml-12px text-14px leading-22px"},w={class:"flex-1 ml-12px text-14px leading-22px"},y=l({__name:"index",props:{data:{}},emits:["setConfirm"],setup(s,{expose:t,emit:l}){const{t:c}=m(),h=s,{title:b,desc:y,data:k,columns:C,api:M,done:j}=h.data,q=l,P=n([]),z=n([...C,{key:"batchStatus",title:"Result",align:"right",width:200,render:s=>"success"===s.batchStatus?d("span",{class:"text-primary"},[s.reqMsg]):"error"===s.batchStatus?d("span",{class:"text-error"},[s.reqMsg]):d("span",{class:"text-warning"},[c("Public.Components.index_11")])}]),D=n(!1),F=n(""),L=s=>{const a=s.filter((s=>"success"===s.batchStatus)).length,e=s.length-a;F.value="".concat(b," has been completed, total ").concat(s.length," tasks, ").concat(a," successes, ").concat(e," failures"),D.value=!0,q("setConfirm",{text:"Done",disabled:!1}),null==j||j(s)};return(()=>{P.value=k.map((s=>({batchStatus:"wait",...s})));const{status:s}=h.data;"done"===s&&L(k)})(),t({onConfirm:({hide:s})=>(D.value?s():(q("setConfirm",{disabled:!0}),e({title:b,hideClose:!0,data:{title:b,api:M,data:P.value,callback:L},component:v})),!1)}),(s,e)=>{const t=a,l=g;return r(),i("div",f,[o("div",_,[p(D)?(r(),i(x,{key:1},[d(t,{name:"base-success",size:"40",class:"text-primary"}),o("div",w,u(p(F)),1)],64)):(r(),i(x,{key:0},[d(t,{name:"base-warning",size:"40",class:"text-warning"}),o("div",S,u(p(y)),1)],64))]),d(l,{"max-height":182,data:p(P),columns:p(z)},null,8,["data","columns"])])}}});export{y as _,v as a};
