import{x as e}from"./xterm-addon-canvas.js?v=1732601582185";import{x as o,a as n,b as a,c as s}from"./xterm.js?v=1732601582185";import{p as t}from"./public.js?v=1732601582185";import{d as l,W as r,r as d,as as i,f as u,o as c,O as m,P as f,n as v}from"./vue.js?v=1732601582185";const w=l({__name:"index",props:{url:{default:"/ws_model"},data:{default:()=>[]}},emits:["message"],setup(l,{emit:w}){const p=l,A=w,{t:x}=r(),{ws:g,status:h,send:O,close:_}=t(p.url,{onMessage:(e,o)=>{const n=o.data;return A("message",n),n.indexOf("Authentication timeout.")>-1&&(j.value=!0),-1==n.indexOf("@127.0.0.1:")&&-1==n.indexOf("@localhost:")||-1==n.indexOf("Authentication failed")?"\\r\\nlogout\\r\\n"==n||"logout\\r\\n"==n||"\r\nlogout\r\n"==n||"logout\r\n"==n||n.search(/logout[\r\n]+$/)>-1?(b.write("\r"+x("Component.Terminal.index_1")+"\r"),y(),void _()):void 0:(_(),void y())}});let b,C;const j=d(!1),k=d(null),z=()=>{const o=g.value;o&&(b.loadAddon(C),b.loadAddon(new e.CanvasAddon),b.loadAddon(new a.WebLinksAddon),b.loadAddon(new s.AttachAddon(o)))},M=()=>{k.value&&b.open(k.value)};let T=!1;const y=()=>{T=!1},D=()=>{(()=>{const{data:e}=p;e.forEach((e=>{O(e)}))})(),b.focus(),b.onData((e=>{const o=g.value;"\r"===e&&j.value&&(j.value=!1,b.write("\r\n"),E()),null!==o||"\r"!==e||T||(T=!0,b.write("\r\n"+x("Component.Terminal.index_2")+"\r\n"),E())}))},E=()=>{D();const e=g.value;e&&b.loadAddon(new s.AttachAddon(e))},F=()=>{v((()=>{if(C.fit(),"CLOSED"!==h.value){const{cols:e,rows:o}=b;O({cols:e,rows:o,resize:1})}}))};let L=!0;const R=new ResizeObserver((()=>{i((()=>{L?L=!1:F()}),200)()}));return u((()=>{b=new o.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#333",foreground:"#ececec"}}),C=new n.FitAddon,z(),M(),D(),F(),(()=>{const e=k.value;e&&R.observe(e)})()})),c((()=>{_(),null==R||R.disconnect(),null==b||b.dispose()})),(e,o)=>(m(),f("div",{ref_key:"terminalRef",ref:k,class:"w-full h-full"},null,512))}});export{w as _};
