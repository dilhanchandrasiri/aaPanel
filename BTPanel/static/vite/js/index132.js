import{u as e,_ as a}from"./useTableData.js?v=1723125373998";import{aB as l,_ as i,j as s,ao as t,O as o,B as n,G as r}from"./index.js?v=1723125373998";import{e as c}from"./file2.js?v=1723125373998";import{u as d}from"./useLoading.js?v=1723125373998";import{b as u}from"./_baseFindIndex.js?v=1723125373998";import{l as p,ad as m,r as f,P as v,S as x,Z as h,V as b,q as k,a3 as y,_ as j,W as g,F as _,ag as w}from"./vue.js?v=1723125373998";import{_ as P}from"./Checkbox.js?v=1723125373998";import{_ as C}from"./Ellipsis.js?v=1723125373998";import"./data.js?v=1723125373998";import"./Skeleton.js?v=1723125373998";import"./DataTable.js?v=1723125373998";import"./Select.js?v=1723125373998";import"./Tag.js?v=1723125373998";import"./Empty.js?v=1723125373998";import"./omit.js?v=1723125373998";import"./pinia.js?v=1723125373998";const F={class:"flex flex-col h-full"},D={class:"flex-1 w-0 truncate"},z={class:"flex flex-1 overflow-hidden"},E={class:"w-160px py-12px overflow-auto"},I=["onClick"],S={class:"flex-1 ml-8px"},T={class:"flex-1","b-l":"1 solid #aaa"},L=p({__name:"index",props:{data:{}},setup(p,{expose:L}){const{t:B}=m(),O=p,{path:$,checkedType:q,callback:A}=O.data,G=f([]),H=f([]),K=f($||"/"),{table:R,columns:U}=e([{key:"checkbox",title:"",width:36,render:e=>q.includes(e.type)?v("div",{onClick:e=>{e.stopPropagation()}},[v(P,{checked:e.filename===H.value[0],onUpdateChecked:a=>{H.value=a?[e.filename]:[]}},null)]):""},{key:"filename",title:B("Public.File.index_3"),render:e=>v("div",{class:"flex"},[v("div",{class:"flex items-center flex-1 cursor-pointer",onClick:a=>{"dir"===e.type&&(a.preventDefault(),K.value+="".concat("/"===K.value?"":"/").concat(e.filename),M(),a.stopPropagation())}},[v("div",null,["dir"===e.type?v(i,{name:"base-dir",size:"16"},null):"","file"===e.type?v(i,{name:"base-file",size:"16",color:"#666"},null):""]),v("div",{class:"ml-6px flex-1 w-0"},[v(C,null,{default:()=>[e.filename]})])])])},{key:"time",title:B("Public.File.index_4"),width:146},{key:"permission",title:B("Public.File.index_5"),width:86},{key:"owner",title:B("Public.File.index_6"),width:72}]),V=e=>({onClick:()=>{if(q.includes(e.type)){const s=(a=H.value,i=a=>a===e.filename,null!=a&&a.length?u(a,l(i),0):-1);H.value=-1!==s?[]:[e.filename]}var a,i},onDblclick:()=>{q.includes(e.type)&&(K.value+="".concat("/"===K.value?"":"/").concat(e.filename),M())}}),W=()=>{const e=K.value.substring(0,K.value.lastIndexOf("/"));K.value=""===e?"/":e,M()},{loading:Z,setLoading:J}=d(),M=async()=>{try{J(!0),R.data=[],H.value=[];const{message:e}=await c({path:K.value});if(s(e)){const a=[],l=t(e,"DIR",[]),i=t(e,"FILES",[]);l.forEach((e=>{a.push(N(e,"dir"))})),i.forEach((e=>{a.push(N(e,"file"))})),K.value=e.PATH,R.data=a,G.value=t(e,"DISK",[])}}finally{J(!1)}},N=(e,a)=>{const l=e.split(";"),i=l[0],s=o(l[2]),t=l[3],n=l[4];return{path:("/"!==K.value?K.value+"/":"")+i,filename:i,time:s,permission:t,owner:n,type:a}};return M(),L({onConfirm:({hide:e})=>{const a=H.value.length>0?H.value[0]:"",l=("/"!==K.value?K.value+"/":"")+a,i=R.data.find((e=>e.filename===a));null==A||A(l,i),e()}}),(e,l)=>{const s=n,t=r,o=a;return x(),h("div",F,[v(t,{class:"items-center h-50px px-12px","b-b":"1 solid #aaa"},{default:b((()=>[v(s,{onClick:W},{default:b((()=>[k(y(e.$t("Public.File.index_1")),1)])),_:1}),j("div",D,y(e.$t("Public.File.index_2"))+": "+y(g(K)),1)])),_:1}),j("div",z,[j("div",E,[(x(!0),h(_,null,w(g(G),(e=>(x(),h("div",{key:e.path,class:"flex items-center p-8px pl-16px hover:bg-#ececec cursor-pointer transition-colors",onClick:a=>{return l=e.path,K.value=l,void M();var l}},[v(i,{name:"file-disk",size:"18",color:"#666"}),j("div",S,y(e.path)+" "+y(e.size[2]?"(".concat(e.size[2],")"):""),1)],8,I)))),128))]),j("div",T,[v(o,{loading:g(Z),"loading-num":10,bordered:!1,"virtual-scroll":!0,"max-height":456,data:g(R).data,columns:g(U),"row-props":V},null,8,["loading","data","columns"])])])])}}});export{L as default};
