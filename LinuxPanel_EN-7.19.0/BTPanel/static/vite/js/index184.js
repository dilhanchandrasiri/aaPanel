import{_ as t,a}from"./index.js?v=1732601582185";import{_ as e}from"./index96.js?v=1732601582185";import{_ as s}from"./index.vue_vue_type_script_setup_true_lang6.js?v=1732601582185";import{f as i,m as l}from"./page_layout.js?v=1732601582185";import{A as n,d as o,h as r,a as d,b as c}from"./public.js?v=1732601582185";import{ag as m,ah as u,ai as p,aj as _,ak as f}from"./mail.js?v=1732601582185";import{_ as h}from"./index.vue_vue_type_script_setup_true_lang.js?v=1732601582185";import{d as x,W as v,r as g,j as w,O as y,P as b,M as j,Y as S,Q as M,R as k,Z as R,ak as P,af as C,X as $,c as B}from"./vue.js?v=1732601582185";import{ad as z,bG as E,aa as O}from"./naive.js?v=1732601582185";import{_ as U}from"./index171.js?v=1732601582185";import"./common.js?v=1732601582185";import"./__commonjsHelpers__.js?v=1732601582185";const A={class:"p-20px"},H={class:"w-260px"},q=x({__name:"hostname",emits:["refresh"],setup(t,{expose:a,emit:s}){const i=s,{t:l}=v(),n=g(null),o=w({hostname:""}),r={hostname:{trigger:["input","blur"],validator:()=>""!==o.hostname.trim()||new Error(l("Mail.Setting.index_50"))}};return a({onConfirm:async()=>{var t;await(null==(t=n.value)?void 0:t.validate()),await m(P(o)),i("refresh")}}),(t,a)=>{const s=z,i=E,l=h,d=e;return y(),b("div",A,[j(l,{ref_key:"formRef",ref:n,model:k(o),rules:r},{default:S((()=>[j(i,{label:t.$t("Mail.Setting.index_48"),path:"hostname"},{default:S((()=>[M("div",H,[j(s,{value:k(o).hostname,"onUpdate:value":a[0]||(a[0]=t=>k(o).hostname=t)},null,8,["value"])])])),_:1},8,["label"])])),_:1},8,["model"]),j(d,{class:"mt-8px"},{default:S((()=>[M("li",null,R(t.$t("Mail.Setting.index_49")),1)])),_:1})])}}}),D=x({__name:"log",emits:["close","close-env"],setup(t,{emit:a}){const e=a,{t:s}=v(),l=g(s("Mail.Setting.index_47")),o=async()=>{const{message:t}=await u();i(t)&&(l.value=t.result||s("Mail.Setting.index_47"))},{loop:r}=n((async()=>{await o()}),1),d=C();return(async()=>{(async()=>{await p(),e("close"),e("close-env"),d.push("/mail/domain")})(),await o(),r()})(),(t,a)=>{const e=U;return y(),$(e,{log:k(l)},null,8,["log"])}}}),G={class:"flex flex-col h-full overflow-hidden"},L={class:"flex-1 p-20px overflow-auto"},N=x({__name:"index",emits:["close"],setup(n,{emit:m}){const u=m,{t:p}=v(),h=["Redis-install","Redis-Passwd","SElinux"],{table:x,columns:g}=o([{key:"env",title:p("Mail.Setting.index_39"),width:150},{key:"details",title:p("Mail.Setting.index_40"),ellipsis:{tooltip:!0},render:t=>{let a="";const{env:e,status:s,details:i}=t,l=h.includes(e);return a=i&&l?s?"Ready":i:s?"Ready":""!=i?i:"Abnormity",j("span",{class:s?"text-primary":"text-error"},[a])}},{key:"action",title:p("Public.Table.Operation"),width:120,render:t=>{const{env:a,status:e,details:s}=t;return h.includes(a)||!s||e?p("Mail.Setting.index_41"):j("a",{class:"bt-link",href:"javascript:;",onClick:()=>{"HostName"===t.env?P(t):C(t)}},[p("Public.Btn.Repair")])}}]),w=r(p("Mail.Setting.index_42"),{onRefresh:()=>{E()}}),P=t=>{w.data.row=t,w.show=!0},C=t=>{d({title:p("Mail.Setting.index_43"),content:p("Mail.Setting.index_44"),onConfirm:async()=>{const{env:a}=t;let e="";switch(a){case"Postfix-Version":case"Postfix-install":case"Sqlite-support":e="repair_postfix";break;case"Rspamd-install":e="install_rspamd";break;case"Dovecot-install":e="repair_dovecot"}await _(a,e),E()}})},{loading:$,setLoading:z}=c(),E=async()=>{try{z(!0);const{message:t}=await f();i(t)&&(x.data=Object.entries(t).map((([t,a])=>({env:t,details:a.msg,status:a.status}))))}finally{z(!1)}},U=()=>{u("close")},A=r(p("Mail.Setting.index_45"),{onCloseEnv:()=>{U()}}),H=async()=>{x.data.every((t=>t.status))?A.show=!0:l.error(p("Mail.Setting.index_46"))};return E(),(i,l)=>{const n=s,o=e,r=t,d=O,c=a;return y(),b("div",G,[M("div",L,[j(n,{"max-height":364,"single-line":!1,loading:k($),data:k(x).data,columns:k(g)},null,8,["loading","data","columns"]),j(o,{class:"mt-20px"},{default:S((()=>[M("li",null,R(i.$t("Mail.Setting.index_38")),1)])),_:1}),j(r,{show:k(w).show,"onUpdate:show":l[0]||(l[0]=t=>k(w).show=t),title:k(w).title,data:k(w).data,width:500,footer:!0,component:q},null,8,["show","title","data"]),j(r,{show:k(A).show,"onUpdate:show":l[1]||(l[1]=t=>k(A).show=t),title:k(A).title,data:k(A).data,"hide-close":!0,width:700,height:490,component:D},null,8,["show","title","data"])]),j(c,null,{default:S((()=>[j(d,{class:"cancel-btn",color:"#cbcbcb",size:"small",onClick:U},{default:S((()=>[B(R(i.$t("Public.Btn.Cancel")),1)])),_:1}),j(d,{type:"primary",size:"small",onClick:E},{default:S((()=>[B(R(i.$t("Public.Btn.Refresh")),1)])),_:1}),j(d,{type:"primary",size:"small",onClick:H},{default:S((()=>[B(R(i.$t("Public.Btn.Submit")),1)])),_:1})])),_:1})])}}});export{N as default};
